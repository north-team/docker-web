(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-71c2bd64"],{2035:function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Page",[s("el-collapse-transition",[s("div",{staticStyle:{display:"flex","justify-items":"center","flex-wrap":"nowrap","justify-content":"space-between"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.iShowTree,expression:"iShowTree"}],staticClass:"transition-box",style:e.iShowTree?"width:250px;":"width:0;"},[s("AutoDataZTree",{key:e.DataZTree,ref:"AutoDataZTree",staticClass:"auto-data-ztree",attrs:{setting:e.treeSetting}})],1),e._v(" "),s("div",{style:e.iShowTree?"display: flex;width: calc(100% - 250px);":"display: flex;width:100%;"},[s("div",{staticClass:"mini"},[s("div",{staticClass:"mini-button",staticStyle:{display:"block"},on:{click:function(t){e.iShowTree=!e.iShowTree}}},[s("i",{directives:[{name:"show",rawName:"v-show",value:e.iShowTree,expression:"iShowTree"}],staticClass:"fa fa-angle-left fa-x"}),s("i",{directives:[{name:"show",rawName:"v-show",value:!e.iShowTree,expression:"!iShowTree"}],staticClass:"fa fa-angle-right fa-x"})])]),e._v(" "),s("IBox",{staticClass:"transition-box",staticStyle:{width:"calc(100% - 17px)"}},[s("Term",{ref:"xterm"}),e._v(" "),s("div",{staticStyle:{display:"flex","margin-top":"10px","justify-content":"space-between"}},[s("div",[s("CodeMirror",{attrs:{options:e.codeMirrorOptions},on:{change:e.handleActionChange}})],1),e._v(" "),s("div",{staticStyle:{display:"flex","flex-direction":"column","justify-content":"space-between"}},[s("el-select",{attrs:{placeholder:this.$t("ops.PleaseSelect")},on:{change:e.handleSystemUserChange},model:{value:e.selectedSystemUser,callback:function(t){e.selectedSystemUser=t},expression:"selectedSystemUser"}},e._l(e.options,(function(e){return s("el-option",{key:e.id,attrs:{disabled:"ssh"!==e.protocol||"auto"!==e.login_mode,label:e.name+"("+e.username+")",value:e.id}})})),1),e._v(" "),s("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.execute}},[e._v(e._s(this.$t("ops.Execute")))])],1)])],1)],1)])])],1)},i=[],n=(s("a481"),s("7f7f"),s("6d67"),s("57e7"),s("ac6a"),s("f3e2"),s("d92a"),s("7885")),o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"terminal",staticClass:"xterm",attrs:{id:"terminal"}})},a=[],c=(s("abb2"),s("fcf3")),l=s("47d0"),h={name:"Term",data:function(){return{xterm:""}},mounted:function(){var e=this.$refs.terminal;this.xterm=new c["Terminal"]({fontFamily:'monaco, Consolas, "Lucida Console", monospace',lineHeight:1.2,fontSize:13,rightClickSelectsWord:!0,theme:{background:"#1f1b1b"}});var t=new l["FitAddon"];this.xterm.loadAddon(t),this.xterm.open(e),t.fit(),this.xterm.scrollToBottom()},beforeDestroy:function(){this.xterm.dispose()},methods:{reset:function(){this.xterm.reset()},write:function(e){this.xterm.write(e)},changeSelectedAssets:function(){}}},d=h,u=s("2877"),m=Object(u["a"])(d,o,a,!1,null,null,null),p=m.exports,f=s("e67a"),w=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("codemirror",e._g(e._b({},"codemirror",e.$attrs,!1),e.$listeners))},b=[],x=(s("1c01"),s("58b2"),s("8e6e"),s("d25f"),s("456d"),s("bd86")),v=s("c884");function y(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function g(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?y(Object(s),!0).forEach((function(t){Object(x["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):y(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var S={components:{codemirror:v["codemirror"]},props:g({},v["codemirror"].props)},C=S,k=Object(u["a"])(C,w,b,!1,null,null,null),O=k.exports,T=s("83b2"),$={name:"CommandExecution",components:{Term:p,AutoDataZTree:n["a"],IBox:f["a"],Page:T["a"],CodeMirror:O},data:function(){return{DataZTree:0,codeMirrorOptions:{lineNumbers:!0,lineWrapping:!0,mode:"shell"},treeSetting:{treeUrl:"",showRefresh:!0,showMenu:!1,check:{enable:!0},view:{dblClickExpand:!1,showLine:!0},data:{simpleData:{enable:!0}},edit:{enable:!0,showRemoveBtn:!1,showRenameBtn:!1,drag:{isCopy:!0,isMove:!0}},callback:{onCheck:this.onCheck.bind(this),onClick:this.onClick.bind(this),onSelected:this.onSelected.bind(this)},async:{enable:!1}},iShowTree:!0,actions:"",options:[],selectedSystemUser:"",basicUrl:"/api/v1/perms/users/nodes-with-assets/tree/?cache_policy=1",ws:"",wsConnected:!1}},computed:{zTree:function(){return this.$refs.AutoDataZTree.$refs.dataztree.$refs.ztree.zTree},xterm:function(){return this.$refs.xterm.xterm}},mounted:function(){var e=this;this.$axios.get("/api/v1/perms/system-users-permission/").then((function(t){if(0!==t.length){for(var s in t)if("ssh"===t[s].protocol&&"auto"===t[s].login_mode){e.handleSystemUserChange(t[s].id),e.selectedSystemUser=t[s].id;break}e.options=t}else e.handleSystemUserChange("")})),this.xterm.write(this.$t("ops.selectAssetsMessage")),this.enableWS()},methods:{handleActionChange:function(e){this.actions=e},onClick:function(e,t,s,r){},onSelected:function(e,t){},handleSystemUserChange:function(e){this.treeSetting.treeUrl="".concat(this.basicUrl,"&system_user=").concat(e),this.xterm.clear(),this.DataZTree++},getSelectedAssetsNode:function(){var e=this.$refs.AutoDataZTree.$refs.dataztree.$refs.ztree.getCheckedNodes(),t=[],s=[];return e.forEach((function(e){if("asset"===e.meta.type&&!e.isHidden){var r=e.meta.data.protocols+"";-1===t.indexOf(e.id)&&r.indexOf("ssh")>-1&&(t.push(e.id),s.push(e))}})),s},onCheck:function(e,t,s){var r=this.getSelectedAssetsNode(),i=r.map((function(e){return e.name})),n=this.$t("ops.selectedAssets");n+=i.join(", "),n+="\r\n",n+=this.$t("ops.inTotal")+"ï¼š".concat(i.length," \r\n"),this.xterm.clear(),this.xterm.write(n)},enableWS:function(){var e=this,t="https:"===document.location.protocol?"wss":"ws",s=document.location.port?":"+document.location.port:"",r="/ws/ops/tasks/log/",i=t+"://"+document.location.hostname+s+r;this.ws=new WebSocket(i),this.ws.onerror=function(t){e.xterm.write(e.wrapperError("Connect websocket server error"))},this.setWsCallback()},setWsCallback:function(){var e=this;this.ws.onmessage=function(t){var s=JSON.parse(t.data),r=s.message;r=r.replace(/Task ops\.tasks\.run_command_execution.*/,""),e.xterm.write(r)}},wrapperError:function(e){return"\r\n".concat(e,"\r\n")},writeExecutionOutput:function(e){var t=this.$t("assets.Pending");this.xterm.write(t),t=JSON.stringify({task:e}),this.ws.send(t)},execute:function(){var e=this,t="rows="+this.xterm.rows+"&cols="+this.xterm.cols,s="/api/v1/ops/command-executions/?"+t,r=this.selectedSystemUser,i=this.actions,n=this.getSelectedAssetsNode().map((function(e){return e.id}));if(0!==n.length)if(i)if(r){var o={hosts:n,run_as:r,command:i};this.$axios.post(s,o).then((function(t){e.writeExecutionOutput(t.id)}))}else this.xterm.write(this.wrapperError(this.$t("assets.NoSystemUserWasSelected")));else this.xterm.write(this.wrapperError(this.$t("assets.NoInputCommand")));else this.xterm.write(this.wrapperError(this.$t("assets.UnselectedAssets")))}}},_=$,j=(s("ea88"),Object(u["a"])(_,r,i,!1,null,"a7b26404",null));t["default"]=j.exports},"3cc2":function(e,t,s){},"4af4":function(e,t,s){},c0eb:function(e,t,s){"use strict";var r=s("1157"),i=s.n(r);window.$=i.a,window.jQuery=i.a,t["a"]=i.a},ea88:function(e,t,s){"use strict";var r=s("4af4"),i=s.n(r);i.a}}]);